"use strict";(this.webpackChunk_msteams_multi_window=this.webpackChunk_msteams_multi_window||[]).push([[41768],{117437:(e,t,r)=>{if(r.d(t,{zF:()=>v,db:()=>p,mM:()=>g,kh:()=>y}),40179==r.j)var o=r(122267);if(40179==r.j)var i=r(573769);if(40179==r.j)var n=r(629255);if(40179==r.j)var a=r(201452);if(40179==r.j)var s=r(227473);if(40179==r.j)var c=r(29013);if(40179==r.j)var l=r(654649);if(40179==r.j)var u=r(240277);if(40179==r.j)var d=r(197994);if(40179==r.j)var h=r(550262);if(40179==r.j)var f=r(587496);const v=(e,t)=>{let r;if(t){const o=a.Jt.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==i.Ch.Anonymous));if(o.length>1){const t=a.Jt.getValue(s.Jl.globalUser);if(r=!!e&&o.find((t=>t.id===e))||o.find((e=>e.id===t.id)),r)return r;throw{message:"Multiple users found in cache with same tenantId",errorCode:c.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return o[0]}if(e){const t=a.Jt.getAllOfType("User");r=null==t?void 0:t.filter((t=>t.id===e))[0]}else r=a.Jt.getValue(s.Jl.globalUser);return r},p=e=>{if(!e)return[];return a.Jt.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},g=(e,t,r,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){null==r||r.addScenarioMark("auth_get_encryption_key_start");const o=a.Jt.getValue(s.Jl.encryptionKey);if("object"==typeof o)return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),o;let n,c;null==r||r.addScenarioMark("auth_get_exported_key_start");try{if(i&&(0,h.n)(e)){const e=yield t.loadModule("auth");n=(yield e.acquireEncryptionKey({correlationId:(null==r?void 0:r.correlation.id)||(0,u.pW)()})).result}else{const e=a.Jt.getValue(s.Jl.exportedEncryptionKey);n=null==e?void 0:e.exportedKey}}catch(e){return null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),null==r||r.addScenarioMark("auth_get_encryption_key_stop"),null}if(!n)return null==r||r.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void(null==r||r.addScenarioMark("auth_get_encryption_key_stop"));try{c=yield e.crypto.subtle.importKey("raw",(0,d.k)(n),{name:"AES-CBC"},!0,["encrypt","decrypt"]),a.Jt.put(s.Jl.encryptionKey,c),null==r||r.addScenarioMark("auth_get_exported_key_stop")}catch(e){null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),c=null}return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),c})),y=(e,t,r)=>{const o=i.JE[n.j[e]],c=v(t,void 0);if(!c)return void l.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const d=(0,f.Xx)(c),h=(0,u.u4)(null==r?void 0:r.reason)||o;a.Jt.put((0,s.VF)(d).userAuthState,{state:o,reason:h,customError:r?{errorCode:r.errorCode||r.code,message:r.message,isExpected:r.isExpected,context:r.context,subContext:r.subContext,correlationId:r.correlationId}:null}),r?l.q.warn(`[AuthState] UserAuthState updated - ${t} : ${o} errorCode: ${r.errorCode} isExpected: ${r.isExpected} correlationId: ${r.correlationId}`):l.q.log(`[AuthState] UserAuthState updated - ${t} : ${o}`)}},201452:(e,t,r)=>{if(r.d(t,{Jt:()=>d,ky:()=>m}),40179==r.j)var o=r(122267);var i=r(29013);if(40179==r.j)var n=r(654649);if(40179==r.j)var a=r(240277);if(40179==r.j)var s=r(587496);if(40179==r.j)var c=r(227473);const l=[i.aw,i.ZU,i.Fz],u={KeyVersion:"v1",UseAccountIdKey:!0};let d;const h=e=>u.UseAccountIdKey?(null==e?void 0:e.id)||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),f=(e,t,r)=>`tmp.auth.${u.KeyVersion}.${e}.${t}.${r}`,v=e=>{const{typeName:t,user:r}=e;return{user:e.user?h(r):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},p=(e,t)=>({storageKey:u.UseAccountIdKey?f(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:f(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class g{constructor(e){this._expireOffsetSeconds=i.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=i.rF.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=(e,t)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){let r=t;t.item.encryptedToken&&(r=this._deepCopyEncryptedToken(t));const o=v(e),{storageKey:i,loggingKey:s}=p(e,o);try{if(this._storage.setItem(i,(0,a.u4)(r)),"LogoutState"===e.typeName){const{storageKey:t}=((e,t)=>({storageKey:u.UseAccountIdKey?`$[${t.user}][${t.typeName}][${t.key}]`:f(t.user,t.typeName,t.key),loggingKey:f(e.user?`${e.user.id}`:t.user,t.typeName,t.key)}))(e,o);this._storage.setItem(t,(0,a.u4)(r))}}catch(e){n.q.error(`error in putting key [${s}] in storage, error - [${(0,a.VK)(e)}]`)}})),this._deepCopyEncryptedToken=e=>{const t=e.item,r=Object.assign({},t);return r.skypeToken?r.skypeToken="":r.token="",{item:r,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh}},this._deleteFromExternalCache=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=v(e),{storageKey:r,loggingKey:o}=p(e,t);try{this._storage.removeItem(r)}catch(e){n.q.error(`error in deleting key [${o}] in storage, error - [${(0,a.VK)(e)}]`)}})),this._flushExternalCache=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t={};Object.keys(this._storage).forEach((r=>{l.forEach((e=>{if(-1!==r.indexOf(e)){const e=this._storage.getItem(r);e&&(t[r]=e)}})),(!e&&0===r.indexOf("$[")||!e&&0===r.indexOf("tmp.auth")||e&&(-1!==r.indexOf(e.oid)||e.id&&-1!==r.indexOf(e.id)))&&this._storage.removeItem(r)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){n.q.error(`error in clearing storage, error - [${(0,a.VK)(e)}]`)}})),this._isGlobalUser=e=>{var t,r;let o=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;return o||(o=this.get(c.Jl.globalUser)),o&&(0,s.FG)((0,s.Xx)(o.item),e)},this._putGlobalUserInCache=(e,t)=>{var r,o;if((null===(o=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===o?void 0:o.User)&&e.user&&!this._isGlobalUser(e.user))return;const i=e.user?"GLOBAL":h((0,s.Xx)(t.item));this._initializeCacheForCacheItem("User",i),this.internalCache[i].User.User=t;const n=u.UseAccountIdKey?f(i,"User","User"):`$[${i}][User][User]`;this._storage.setItem(n,JSON.stringify(t))},this._validateValue=(e,t)=>{var r,o;if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==i.rz||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const n=t;if(!(n.userName&&n.type&&n.role&&n.profile&&void 0!==n.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!n.userName}], type: [${n.type}], role: [${n.role}], profile exists: [${!!n.profile}],isAuthenticated: [${n.isAuthenticated}]`);const a=null===(o=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===o?void 0:o.User,c=(0,s.Xx)(n);if(a&&!e.user&&!this._isGlobalUser(c))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,n.q.info("auth_cache initialized")}updateSetting(e,t){n.q.log(`Updating authCache setting ${e} from ${u[e]} to ${t}.`),"KeyVersion"===e&&(t!==u.KeyVersion&&(this.internalCache={}),u.KeyVersion=t),"UseAccountIdKey"===e&&(t!==u.UseAccountIdKey&&(this.internalCache={}),u.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){var r,o;y(e),this._validateValue(e,t);const{typeName:i,key:n,user:a}=v(e);("Token"===i||"Discover"===i&&"SKYPE-TOKEN"===n)&&(t.fromCache=!0);let s=null===(o=null===(r=this.internalCache[a])||void 0===r?void 0:r[i])||void 0===o?void 0:o[n];return s?(s.hitCount=0,s.item=t):s={item:t,shouldRefresh:!1,hitCount:0},"User"===i&&this._putGlobalUserInCache(e,s),this._initializeCacheForCacheItem(i,a),this.internalCache[a][i][n]=s,this._addToExternalCache(e,s),!0}updateGlobalUser(e){const t="GLOBAL",r={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache.GLOBAL.User.User=r,this._addToExternalCache(c.Jl.globalUser,r),!0}get(e){var t,r,o;y(e);const i=v(e),{storageKey:s,loggingKey:c}=p(e,i),{typeName:l,key:u,user:d}=i;let h=null===(r=null===(t=this.internalCache[d])||void 0===t?void 0:t[l])||void 0===r?void 0:r[u];const f=!!h;if(!h)try{const e=null===(o=this._storage)||void 0===o?void 0:o.getItem(s);e&&(h=JSON.parse(e))}catch(e){n.q.error(`value for key [${c}] throw error. ${(0,a.VK)(e)}`)}if(h)return this._initializeCacheForCacheItem(l,d),this.internalCache[d][l][u]=h,("Token"===l||"Discover"===l&&"SKYPE-TOKEN"===u)&&(h.shouldRefresh=this._shouldRefresh(h.item,l),h.hitCount++,this.internalCache[d][l][u]=h,this._addToExternalCache(e,h)),void 0===h.shouldRefresh?(n.q.info(`cacheItem '[${s}]' need to refresh`),void this.del(e)):(n.q.info(`returning cacheItem '[${s}]' from cache. In memory:${+f} found: [${+!!h}]`),h);n.q.info(`value for key [${c}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],r=[];return Object.keys(this.internalCache).forEach((o=>{"GLOBAL"!==o&&Object.keys(this.internalCache[o][e]||{}).forEach((i=>{const{storageKey:n}=p({},{user:o,typeName:e,key:i});r.push(n),t.push(this.internalCache[o][e][i].item)}))})),Object.keys(this._storage).forEach((o=>{var i;if(-1===r.indexOf(o)&&-1===o.indexOf(".GLOBAL.")&&-1===o.indexOf("[GLOBAL]")&&(-1!==o.indexOf(`[${e}]`)||-1!==o.indexOf(`.${e}.`)))try{const e=this._storage.getItem(o);e&&t.push(null===(i=JSON.parse(e))||void 0===i?void 0:i.item)}catch(e){n.q.error(`value for key [${o}] throw error. ${(0,a.VK)(e)}`)}})),t}del(e){var t,r,o,i;if(!e)return n.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return n.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const a=v(e),{loggingKey:s}=p(e,a),{typeName:c,key:l,user:u}=a;(null===(r=null===(t=this.internalCache[u])||void 0===t?void 0:t[c])||void 0===r?void 0:r[l])&&n.q.info(`Value of key: [${s}] exists before deletion]`);const d=(null===(i=null===(o=this.internalCache[u])||void 0===o?void 0:o[c])||void 0===i?void 0:i[l])&&delete this.internalCache[u][c][l],h=this._deleteFromExternalCache(e);return n.q.info(`deleted from local auth-cache. key: [${s}], done - local: [${d}], storage: [${h}]`),d}delTokensWithError(e,t){var r,o,i,n;const{user:a,typeName:s}=v({user:e,typeName:"Token"});if(null===(r=this.internalCache[a])||void 0===r?void 0:r[s]){const r=this.internalCache[a][s];for(const a in r)(null===(n=null===(i=null===(o=r[a])||void 0===o?void 0:o.item)||void 0===i?void 0:i.error)||void 0===n?void 0:n.errorCode)===t&&this.del({user:e,typeName:s,key:a})}}deleteType(e,t){var r;const{user:o,typeName:i}=v({user:e,typeName:t});if(null===(r=this.internalCache[o])||void 0===r?void 0:r[i]){let t;if("Token"===i)t=this.internalCache[o][i];else{if("Discover"!==i)return;t=this.internalCache[o][i]}for(const r in t)r&&this.del({user:e,typeName:i,key:r})}}flush(e){var t,r;if(!e){n.q.info("no user provided, flushing global user from cache");const o=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;if(!o)return;e=(0,s.Xx)(o.item)}n.q.info("flushing user data from cache");const o=h(e);this.internalCache[o]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),n.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){const r="Token"===t?null==e?void 0:e.expires:null==e?void 0:e.expiration,o=Math.round(Date.now()/i.rF.MILLI_PER_SECOND);let n;if(n="Discover"===t?Math.round(r/i.rF.MILLI_PER_SECOND):"Token"===t?r:void 0,e&&n){const e=n-this._expireOffsetSeconds;if(o<=n-this._expireOffsetSecondsMin)return o>=e}}}const y=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},m=e=>{var t;return d||(d=new g(e),(null===(t=e.localStorage)||void 0===t?void 0:t.getItem("localDebug"))&&e.loader&&(e.loader.authCache=d),d)}},227473:(e,t,r)=>{r.d(t,{VF:()=>i,px:()=>n,Jl:()=>a});var o=r(29013);const i=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"}}),n=(e,t,r)=>({user:e,typeName:"Token",key:`${t}${r?`-external-${r}`:""}`}),a={logoutState:{typeName:o.ZU},authSessionId:{typeName:o.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"}}},550262:(e,t,r)=>{r.d(t,{n:()=>o});const o=e=>{var t;return!!(null===(t=null==e?void 0:e.chrome)||void 0===t?void 0:t.webview)}},587496:(e,t,r)=>{if(r.d(t,{b6:()=>p,yI:()=>g,B$:()=>y,vt:()=>m,LP:()=>_,QG:()=>C,nL:()=>S,Ig:()=>b,Xx:()=>$,qv:()=>k,nW:()=>O,aS:()=>I,Kv:()=>U,FG:()=>M,fM:()=>w,jV:()=>A,PU:()=>N,dW:()=>T,au:()=>D,S1:()=>j,NL:()=>q,WD:()=>L,_Z:()=>F,ps:()=>K,Fr:()=>P,N3:()=>G}),40179==r.j)var o=r(122267);var i,n=r(458281);if(40179==r.j)var a=r(573769);if(40179==r.j)var s=r(541294);if(40179==r.j)var c=r(654649);if(40179==r.j)var l=r(29013);if(40179==r.j)var u=r(201452);if(40179==r.j)var d=r(845582);if(40179==r.j)var h=r(240277);if(40179==r.j)var f=r(227473);if(40179==r.j)var v=r(117437);!function(e){e.Otp="mail",e.GFed="google.com"}(i||(i={}));const p=e=>(c.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(l.uI.FIFTEEN)/l.rF.MILLI_PER_SECOND),fromCache:!0}),g=(e,t,r)=>{if(e===a.G7.prod||e===a.G7.life)return"";const o=null==r?void 0:r("instanceUrl"),i=o?`${o}${null!=t?t:"common"}`:"";return c.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${i}`),i},y=(e,t,r,o)=>{const i=(null==t?void 0:t.profile.tid)||r||(null==e?void 0:e.tenantId);if(i&&(t||o||(null==e?void 0:e.isAnonEligible)&&(null==e?void 0:e.isAnonRestrictionSatisfied)))return _(i,t)},m=e=>{const t=e.homeAccountId;return null==t?void 0:t.split(".")[0]},_=(e,t)=>{var r;c.q.info("Anon flow - anonymous user created");const o=e===l.zP;return{id:E,isAuthenticated:!0,userName:(null==t?void 0:t.userName)||"anonymous",profile:{oid:k(e),tid:e,upn:(null===(r=null==t?void 0:t.profile)||void 0===r?void 0:r.upn)||"",puid:""},role:a.w4.Anonymous,type:a.Ch.Anonymous,homeAccountId:E,cloud:(null==t?void 0:t.cloud)||(o?a.G7.life:a.G7.prod),subType:a.Yf.Default}},C=e=>e===s.e0?a.Ch.MsaLife:a.Ch.Aad,S=e=>{if(C(e.profile.tenantId)===a.Ch.MsaLife)return a.G7.life;switch(e.profile.sovereignty){case a.qn.prod:return a.G7.prod;case a.qn.gcch:return a.G7.gcch;case a.qn.dod:return a.G7.dod;default:return a.G7.prod}},b=(e,t,r,o)=>{var u,d,h,f,v,p;if(!t||(0,n.isEmpty)(t.profile)||t.role===a.w4.Anonymous||t.userRole===l.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&o)return c.q.info("checking anon flow"),y(e,t,r,o);t.role=1===(null===(u=t.profile)||void 0===u?void 0:u.acct)?a.w4.Guest:a.w4.Member;let g=0===(null===(h=null===(d=t.profile)||void 0===d?void 0:d.altsecid)||void 0===h?void 0:h.indexOf("1:"))?a.Ch.Msa:a.Ch.Aad;return(null===(f=t.profile)||void 0===f?void 0:f.idp)&&(null===(v=t.profile)||void 0===v?void 0:v.iss)!==t.profile.idp?(g=t.profile.idp===i.Otp?a.Ch.Otp:g,g=t.profile.idp===i.GFed?a.Ch.GFed:g):(null===(p=t.profile)||void 0===p?void 0:p.tid)===s.e0&&(g=a.Ch.MsaLife),x(t,g)},x=(e,t)=>(e.type=t,e.profile.oid=e.profile.oid||k(e.profile.tid),e.cloud||(e.cloud=e.type===a.Ch.MsaLife?a.G7.life:a.G7.prod),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=a.Yf.Default),c.q.info(`User role = [${e.role}], type = [${t}]`),e),$=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},k=e=>`8:defaultOid:${e}`,E="anonAccountId",O=e=>{const t=[];for(const r in e)Object.hasOwnProperty.call(e,r)&&e[r]&&t.push({name:r,key:r,value:"string"==typeof e[r]?e[r]:(0,h.u4)(e[r])});return t},I=(e,t)=>{var r;t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const o=(0,v.zF)(e,void 0);if(o)return t.addScenarioMark("auth_update_global_user_foundUser"),u.Jt.updateGlobalUser(o);throw t.addScenarioMark("auth_update_global_user_noUserFound"),i=null===(r=t.correlation)||void 0===r?void 0:r.id,(0,d.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:i,errorCode:l.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"});var i},U=e=>e?(null==e?void 0:e.id)?null==e?void 0:e.id:`${null==e?void 0:e.oid}-${null==e?void 0:e.tenantId}`:"unknown user",M=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),w=(e,t,r)=>{var o;const i=new CustomEvent(t,{detail:r});null===(o=null==e?void 0:e.dispatchEvent)||void 0===o||o.call(e,i)},A=(e,t,r,o,i)=>{const n=b(e,t,o,i);return n&&(c.q.info(`[auth-helper][getMappedUserAndSetItToCache][${r}] put user in cache.`),u.Jt.put((0,f.VF)($(n)).user,n)),n},N=(e,t,r,o)=>{if(l.s9(e))throw o.addEventData(["scope_invalid:1"]),c.q.warn(`[core-auth-base][acquireToken][${r.source}][${r.id}] invalid scope. resource: [${e}]`),(0,d.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${null==t?void 0:t.id}-${null==t?void 0:t.oid}-${null==t?void 0:t.tenantId}] sent from invalid resource: ${e}`,errorCode:l.SM.InvalidScopeResource,isExpected:!0,correlationId:r.id})},T=(e,t,r,o,i)=>(o.push("user_missing"),(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UserNotFoundError,isExpected:r,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:i})),D=(e,t,r,o)=>(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UnsupportedParameter,isExpected:r,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:o});const j=(e,t,r,o,i,n)=>{var a,s;null==o||o.push(`errorCode:${(null==t?void 0:t.errorCode)||"undefined"},errorMessage:${(null==t?void 0:t.message)||"undefined"}`),o&&o.length>0&&o.push("$");const u=function(e,t,r="",o,i){return{contentType:r,context:"core-auth-base",correlationId:null==t?void 0:t.correlationId,endpointUrl:i||"unset",errorCode:(null==t?void 0:t.errorCode)||"AcquireToken Error",innerError:t,isExpected:null==t?void 0:t.isExpected,message:(0,h.VK)(t),reason:(null==o?void 0:o.join(";"))||"",subContext:e}}(e,t,i,o,n),d=u.errorCode.includes(l.SM.InvalidScopeResource)||(null===(a=u.message)||void 0===a?void 0:a.includes(l.SM.InvalidScopeResource))||u.isExpected||(null===(s=u.innerError)||void 0===s?void 0:s.isExpected);return d?c.q.warning(`Error found ${(0,h.VK)(t)}`):c.q.error(`Error found ${(0,h.VK)(t)}`),d?null==r||r.incomplete(u):null==r||r.fail(u),u},q=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),L=e=>!(!e||e===q),F=(e,t,r,o,i)=>{var n,a,s,l;return r.tflClaim&&(r.accessTokenToRenew=r.tflClaim),void 0===r.prompt&&void 0===r.silent&&(!r.accessTokenToRenew&&!L(r.claim)||(null==o?void 0:o("disablePromptFor401"))&&!((e,t)=>{const r=(null==t?void 0:t("enablePromptResourcesFor401"))||[];return!(!e||!r)&&Array.isArray(r)&&r.findIndex((t=>e.includes(t)))>-1})(e,o)?(r.prompt="none",r.silent=!0):(r.prompt="login",r.silent=!1)),t.addEventData(["cacheToken:"+ +!!i,"tflClaim:"+ +!!r.tflClaim,"accessTokenToRenew:"+ +!!r.accessTokenToRenew,"forceRenew:"+ +!!r.forceRenew,`prompt: ${r.prompt}`,"silent:"+ +!!r.silent]),(null===(a=null===(n=null==i?void 0:i.item)||void 0===n?void 0:n.error)||void 0===a?void 0:a.errorCode)&&t.addEventData([`errorInToken:[${(null===(l=null===(s=null==i?void 0:i.item)||void 0===s?void 0:s.error)||void 0===l?void 0:l.errorCode)||""}]`]),i?(r.forceRenew&&(c.q.info("[core-auth-base][acquireToken] force renewing."),r.accessTokenToRenew=i.item.token),r):r},K=(e,t,r,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=null==n?void 0:n("buildCloud"),a=null==n?void 0:n("enableMultiCloud");if(c.q.log(`starting cloud misMatch check. Env: ${r}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),!e.cloud||!o||e.cloud===o)return!0;if(a)return t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, enableMultiCloud: ${a}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`}),Promise.reject(R(e,i));throw u.Jt.del({user:$(e),typeName:"User"}),t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, buildCloud: ${o}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`}),new Error("cloud mis-match... reboot required")})),P=(e,t,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise((i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(e.length<=0)return i({count:0,failure:[]});let o=0;const n=[];for(const a of e){o++;try{const r=t(a);yield r,o>=e.length&&i({count:o,failure:n})}catch(t){n.push(o),null==r||r(t,o,a),o>=e.length&&i({count:o,failure:n})}}}))))})),R=(e,t)=>{const r={cloud:e.cloud,accountId:e.id};return(0,d.MD)({errorMetaData:r,authSubErrorCode:"MultiCloudMismatch",name:l.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t,errorCode:l.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0})},G=(e,t,r,o)=>{L(r)&&e.addEventData([`isSameToken: ${o===t.token}`]);const i=(e=>{const t=(e-Math.floor((new Date).getTime()/l.rF.MILLI_PER_SECOND))*l.rF.MILLI_PER_SECOND/l.rF.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${i}`,`fromCache: ${t.fromCache}`])}},197994:(e,t,r)=>{r.d(t,{z:()=>i,k:()=>n});var o=r(61346);const i=e=>o.Buffer.from(e).toString("base64"),n=e=>o.Buffer.from(e,"base64")},301834:(e,t,r)=>{if(r.d(t,{g:()=>f}),40179==r.j)var o=r(573769);if(40179==r.j)var i=r(845582);if(40179==r.j)var n=r(240277);if(40179==r.j)var a=r(587496);var s=r(29013);if(40179==r.j)var c=r(654649);if(40179==r.j)var l=r(915657);let u,d,h;function f(e,t,r,o){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{h=!0},disable:()=>{h=!1},setConfig:v}}),function(e,t){u||(u={});u[t]=e}(e,t),h=o,h){try{d="string"==typeof r?Object.assign(Object.assign({},d),JSON.parse(decodeURIComponent(r))):Object.assign(Object.assign({},d),r)}catch(e){c.q.warning(`[MOCK-API] cannot parse config: ${r}`)}p(e,t)}else d={}}function v(e,t={}){d||(d={}),d[e]=t;const r=e.split(".")[0];p(null==u?void 0:u[r],r)}function p(e,t){Object.getOwnPropertyNames(d).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((r=>{var o,a;const s=(null===(o=Object.getOwnPropertyDescriptor(e,r))||void 0===o?void 0:o.value)||(null===(a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r))||void 0===a?void 0:a.value);Object.defineProperty(e,r,{configurable:!0,value:(...o)=>h?(c.q.warning(`[MOCK-API] returning mocked response for ${t}.${r}`),function(e,t){var r;const o=null==d?void 0:d[`${e}.${t}`];if(o&&o.error)throw function(e,t,r){return(0,i.Tr)({context:(null==e?void 0:e.context)||t,subContext:(null==e?void 0:e.subContext)||r,reason:null==e?void 0:e.reason,errorCode:(null==e?void 0:e.errorCode)||"ErrorCodeNotFound",correlationId:(null==e?void 0:e.correlationId)||(0,n.pW)(),isExpected:(null==e?void 0:e.isExpected)||!1,message:(null==e?void 0:e.message)||`[MockApi][${t}][${r}]`})}(o.error,e,t);if(o&&o.success){const e=function(e){switch(e){case"aquireToken":return y;case"user":return g();case"hostMachineUsers":return[m];case"users":return[g()];case"emptyList":return[]}return{}}(o.success.defaultValue);return Array.isArray(e)?o.success.returnValue?Array.isArray(o.success.returnValue)?[...e,...o.success.returnValue]:[...e,o.success.returnValue]:e:Object.assign(Object.assign({},e),null===(r=o.success)||void 0===r?void 0:r.returnValue)}return}(t,r)||s.apply(e,o)):s.apply(e,o)})}))}const g=()=>(0,a.Ig)(new l.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:o.w4.Member,profile:{name:"Test",oid:(0,a.qv)("123456789"),tid:"123456789"}}),y={token:"TestToken",expires:Date.now()+s.rF.SECONDS_FIVE_MINUTES,fromCache:!1},m={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},915657:(e,t,r)=>{if(r.d(t,{N:()=>n,j:()=>l}),40179==r.j)var o=r(29013);if(40179==r.j)var i=r(654649);class n{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const r=e.replace(/\+/g," ").split("=");let o=r.shift();const n=r.length>0?decodeURIComponent(r.join("=")):null;if(o){if(o=decodeURIComponent(o),"context"===o&&0===(null==n?void 0:n.indexOf("{")))try{const e=JSON.parse(n);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t=Object.assign(Object.assign({},t),e)}catch(e){i.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,o))Array.isArray(t[o])?t[o].push(n):t[o]=[t[o],n];else{t[o]=n;const e=o.toLowerCase();!n||"tid"!==e&&"tenantid"!==e||(this._tid=n)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const r=this._hash.indexOf("?");r>=0&&(this._search=this._hash.substr(r))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=a(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?o.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}}const a=e=>{if(!c)return[!1,!1];for(const t of c)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,s(t,e.href)];return[!1,!1]},s=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const r of e.restrictions)if(t.indexOf(r)>-1)return!0;return!1};let c=40179==r.j?[]:null;const l=e=>{e&&(c=e)}},629255:(e,t,r)=>{var o;r.d(t,{j:()=>o}),function(e){e.Up="Up",e.InteractionRequired="InteractionRequired",e.AADReconnecting="AADReconnecting",e.SkypeReconnecting="SkypeReconnecting"}(o||(o={}))},654649:(e,t,r)=>{r.d(t,{q:()=>i});var o=r(541294);const i=new class{constructor(){this.logLevel=o.in.Info,this.localCallback=void 0,this.error=e=>this.logMessage(o.in.Error,e),this.warning=e=>this.logMessage(o.in.Warning,e),this.warn=e=>this.logMessage(o.in.Warning,e),this.info=e=>this.logMessage(o.in.Info,e),this.log=e=>this.logMessage(o.in.Info,e),this.verbose=e=>this.logMessage(o.in.Verbose,e),this.debug=e=>this.logMessage(o.in.Verbose,e)}initialize(e,t=o.in.Verbose){this.localCallback=e,this.logLevel=t}executeCallback(e,t){this.localCallback?this.localCallback(e,t):console&&console.log(t)}logMessage(e,t){if(e>this.logLevel)return;const r=`[Auth]: ${t}`;this.executeCallback(e,r)}}},656570:(e,t,r)=>{r.d(t,{n:()=>o});class o{}o._authTelemetryCollection={},o._correlationMap={},o._userBiServiceMap={},o.getUserBiService=e=>o._userBiServiceMap[e]||o._userBiServiceMap.GLOBAL,o.setUserBiService=(e,t)=>{t?o._userBiServiceMap[e]=t:delete o._userBiServiceMap[e]},o.getAuthTelemetry=e=>o._authTelemetryCollection[e],o.setAuthTelemetry=(e,t)=>o._authTelemetryCollection[e]=t,o.delete=e=>{delete o._authTelemetryCollection[e];const t=Object.keys(o._correlationMap);for(const r in t)if(o._correlationMap.hasOwnProperty(t[r])){const i=t[r],n=o._correlationMap[i];n&&(o._correlationMap[i]=n.filter((t=>t!==e)))}},o.getCorrelation=e=>o._correlationMap[e],o.setCorrelation=e=>{const t=o.getCorrelation(e.scenarioName)||[];-1===t.indexOf(e.id)&&t.push(e.id),o._correlationMap[e.scenarioName]=t}},500167:(e,t,r)=>{if(r.d(t,{u:()=>l,OU:()=>u,ld:()=>h,cv:()=>f,Tu:()=>v}),40179==r.j)var o=r(122267);if(40179==r.j)var i=r(654649);if(40179==r.j)var n=r(240277);if(40179==r.j)var a=r(136263);if(40179==r.j)var s=r(656570);class c{constructor(e,t,r){this._scenarioProvider=e,this._authCache=t,this._telemetryService=r,this.create=e=>this._createScenario(e,!0),this.createNew=e=>{var t;const r=new a.q(this._scenarioProvider,e.correlation,this._authCache,e.subContext,!0,null!==(t=e.isBatch)&&void 0!==t&&t,e.timeoutMs,this._telemetryService);return e.scenarioEventData&&r.appendScenarioEventData(e.scenarioEventData),r},this.createWithoutScenario=e=>this._createScenario(e,!1),this.getCorrelation=e=>s.n.getCorrelation(e)||[],this._createScenario=(e,t)=>{var r,o;const{correlation:i,subContext:n,scenarioEventData:c,timeoutMs:l,scenario:u,isBatch:d}=e;let h=s.n.getAuthTelemetry(i.id);if(h)h.addEventData([`fn:${n}`]);else{const c=null===(r=this._telemetryService)||void 0===r?void 0:r.getTelemetryServicesCache().get(null===(o=e.scenarioEventData)||void 0===o?void 0:o.accountId);h=new a.q((null==c?void 0:c.coreScenarioFactory)||this._scenarioProvider,i,this._authCache,n,t,null!=d&&d,l,(null==c?void 0:c.telemetryService)||this._telemetryService,u),s.n.setAuthTelemetry(i.id,h)}return c&&h.appendScenarioEventData(c),s.n.setCorrelation(i),h}}}const l=(e,t)=>{s.n.setUserBiService(e||"GLOBAL",t)},u=e=>{var t,r,i,a,s,c;e.options.correlation={id:null!==(r=null===(t=e.options.correlation)||void 0===t?void 0:t.id)&&void 0!==r?r:(0,n.pW)(),scenarioName:null!==(a=null===(i=e.options.correlation)||void 0===i?void 0:i.scenarioName)&&void 0!==a?a:e.scenarioName,source:null!==(c=null===(s=e.options.correlation)||void 0===s?void 0:s.source)&&void 0!==c?c:e.source};const{options:{correlation:l}}=e,u=(0,o.__rest)(e,["options"]);return d(Object.assign({correlation:l},u))},d=e=>{const{correlation:t,subContext:r,scenarioEventData:o,eventData:i,timeoutMs:n,scenario:a,isBatch:c}=e,l=s.n.getAuthTelemetry(t.id),u=(e.startWithoutScenario?f.createWithoutScenario:f.create)({correlation:t,subContext:r,scenarioEventData:o,timeoutMs:n,scenario:a,isBatch:c});i&&u.addEventData(i);return[u,(e,t)=>u.closeScenario(e,t,!!l)]},h=e=>f.getCorrelation(e);let f;const v=(e,t,r)=>{f||(f=new c(e,t,r),i.q.log("authTelemetryProvider initialized"))}},136263:(e,t,r)=>{if(r.d(t,{q:()=>l}),40179==r.j)var o=r(685554);if(40179==r.j)var i=r(654649);if(40179==r.j)var n=r(240277);if(40179==r.j)var a=r(668830);if(40179==r.j)var s=r(845582);if(40179==r.j)var c=r(656570);class l{constructor(e,t,r,l,u,d,h,f,v){this._scenarioFactory=e,this._correlation=t,this._authCache=r,this._subContext=l,this._shouldCreateScenario=u,this._isBatch=d,this._timeoutMs=h,this._telemetryService=f,this._eventData=[],this._localScenarioEventData={},this._loggingPrefix="",this.appendScenarioEventData=e=>{this._scenario&&this._scenario.appendEventData(e),this._localScenarioEventData=Object.assign(Object.assign({},this._localScenarioEventData),e)},this.addEventData=e=>{Array.prototype.push.apply(this._eventData,e)},this.getEventData=()=>[...this._eventData],this.addScenarioMark=(e,t={},r)=>{t=this._mapEventData(t,r),this._scenario?this._scenario.mark(e,t,t.status):this.addEventData([`${e}:${t.status}`]),i.q.log(`${this._loggingPrefix} [${e}][${t.status}][scenarioEventData][${(0,n.u4)(t)}]`)},this.closeScenario=(e={},t,r)=>{var o;if(e=this._mapEventData(e,t),r)return e.reason&&this.addEventData([`reason:${e.reason}`]),e.errorCode&&this.addEventData([`errorCode:${e.errorCode}`]),void this.addEventData([`${this._subContext}$:${e.status}`]);if(this._isBatch&&(this._batchScenarioStartTime&&(e.perfDelta=performance.now()-this._batchScenarioStartTime),e.correlationId=null!==(o=e.correlationId)&&void 0!==o?o:this._correlation.id,"success"===e.status?(0,a.f)(this._scenarioFactory,this._authCache,this._correlation.scenarioName,e):"failure"===e.status?(0,a.E)(this._scenarioFactory,this._authCache,this._correlation.scenarioName,e):i.q.log(`Counter is not updated for batch scenario with status ${e.status}`)),!this._scenario){const t=this._shouldCreateScenario?i.q.warn:i.q.log,r=this._shouldCreateScenario?"[N/A]":"";return this.logEventData(t,`${this._loggingPrefix} [stop]${r} [scenarioEventData]`,e),void c.n.delete(this._correlation.id)}switch(e.status){case"incomplete":this._scenario.incomplete(e);break;case"failure":this._scenario.fail(e);break;case"abandoned":this._scenario.cancel(e);break;default:this._scenario.stop(e)}const n="failure"===e.status?i.q.error:i.q.log;this.logEventData(n,`${this._loggingPrefix} [stop][${e.status}] [e]`,e),c.n.delete(this._correlation.id)},this.createScenario=(e,t,r)=>{this._scenario?i.q.warn(`createScenario called with [${this._subContext}][${(0,n.u4)(this._correlation)}]::${e}, but there is already a scenario with that correltion id`):(this._createScenario(e,r||this._timeoutMs,Object.assign(Object.assign({},this._localScenarioEventData),t)),i.q.log(`${this._loggingPrefix} [create] - scenario created`))},this.recordAuthUserBiTelemetry=(e,t)=>{const r={panelRegion:o.Ai.main,panelType:o.wh.AuthStart,actionWorkload:o.sz.auth,actionSubworkload:o.eD.sisu,actionScenarioType:o.Yu.appAuth,actionScenario:t.scenario,actionGesture:t.actionGesture||o.uS.auto},n=c.n.getUserBiService(e||"GLOBAL");n&&n.recordPanelAction(r,i.q)},this.setUserToTelemetryContext=e=>{var t,r,o,i,n,a;if(e){const{id:s,oid:c,tid:l,type:u,role:d,subType:h}=e;void 0!==s&&(null===(t=this._telemetryService)||void 0===t||t.setCoreContext("userId",s===c?"":s)),void 0!==c&&(null===(r=this._telemetryService)||void 0===r||r.setCoreContext("UserInfo.Id",c)),void 0!==l&&(null===(o=this._telemetryService)||void 0===o||o.setCoreContext("UserInfo.TenantId",l)),void 0!==u&&(null===(i=this._telemetryService)||void 0===i||i.setCoreContext("UserInfo.Type",u)),void 0!==d&&(null===(n=this._telemetryService)||void 0===n||n.setCoreContext("UserInfo.Role",d)),void 0!==h&&(null===(a=this._telemetryService)||void 0===a||a.setCoreContext("UserInfo.SubType",h)),this.addScenarioMark(`${this._correlation.scenarioName}_set_user_on_telemetry_context`)}},this.setUserDetailsToTelemetryContext=e=>{var t;if(e){const{region:r}=e;void 0!==r&&(null===(t=this._telemetryService)||void 0===t||t.setCoreContext("UserInfo.Region",r)),this.addScenarioMark(`${this._correlation.scenarioName}_set_tenant_details_on_telemetry_context`)}},this._mapEventData=(e,t)=>{var r,o;return e.subContext=e.subContext||this._subContext,(e=Object.assign(Object.assign({},this._localScenarioEventData),e)).error&&(e.error=Object.assign(Object.assign({},e.error),{stack:this.scrubQsString("loginHint",e.error.stack),message:e.error.message,errorMetaData:void 0}),e.message=`[message]${null!==(r=e.message)&&void 0!==r?r:""} [errorMessage]${e.error.message}`,e.errorCode=null!==(o=e.error.code)&&void 0!==o?o:e.error.errorCode,this.addEventData([`errorCode:${e.error.errorCode}`])),!t&&e.error&&(t=(0,s.ZG)(e.error)?"incomplete":"failure"),e.eventData=this._eventData.join(","),e.status=t||"success",e},this._createScenario=(e,t,r)=>{var o,n,a;const s=t?{timeoutMs:t}:{};this._scenario=null!==(o=this._scenarioFactory.findScenario(e))&&void 0!==o?o:this._scenarioFactory.newScenario(e,s);try{null===(a=(n=this._scenarioFactory).hoistScenarioToCore)||void 0===a||a.call(n,this._scenario)}catch(e){i.q.log(`${this._loggingPrefix} ${e.message}`)}this._scenario.appendEventData(Object.assign({secondaryCorrelationId:this._correlation.id,commandSource:this._correlation.source},r)),this._shouldCreateScenario=!0},this.loggingPrefix=()=>`[Telemetry][${this._correlation.id}][${this._correlation.scenarioName}]`,this.logEventData=(e,t,r)=>{r.error||delete r.error;const o=this.splitStringEqually((0,n.u4)(r));for(const r of o)e(`${t}${r}`)},this.splitStringEqually=(e,t=300)=>{const r=new RegExp(`.{1,${t}}`,"g"),o=e.match(r);return o||[]},this.scrubQsString=(e,t)=>{if(!t)return"";const r=new RegExp(`${e}=[^?&:)]*`,"gi");return t.replace(r,"scrubbed")},this._loggingPrefix=this.loggingPrefix(),this._isBatch&&(this._batchScenarioStartTime=performance.now()),u&&(v?this._scenario=v:this._createScenario(this._correlation.scenarioName,this._timeoutMs,void 0)),i.q.log(`${this._loggingPrefix} [start] - telemetry provider created for ${this._subContext}, source: ${this._correlation.source} with shouldCreateScenario: [${u}]`),i.q.log(`Auth cache defined: ${!!this._authCache}, is batch: ${this._isBatch}`),this._eventData.push(`^source:${this._correlation.source},fn:${this._subContext}`)}get correlation(){return Object.assign({},this._correlation)}}},668830:(e,t,r)=>{if(r.d(t,{f:()=>a,E:()=>s}),40179==r.j)var o=r(654649);if(40179==r.j)var i=r(240277);const n="batch_";function a(e,t,r,o){var i;const{accountId:n}=o,a=h(t,n);if(!a)return;const s=null!==(i=d(t,a,r))&&void 0!==i?i:{};s.successMetaData?(s.successMetaData.batchScenarioCounter++,s.successMetaData.batchEventData.push(o)):s.successMetaData={batchScenarioCounter:1,batchEventData:[o]},s.successMetaData.batchScenarioCounter>=1e3?(c(e,r,s.successMetaData,"success",n),s.failureMetaData&&c(e,r,s.failureMetaData,"failure",n),l(t,a,r)):u(t,a,r,s)}function s(e,t,r,o){var i;const{accountId:n}=o,a=h(t,n);if(!a)return;const s=null!==(i=d(t,a,r))&&void 0!==i?i:{};s.failureMetaData?(s.failureMetaData.batchScenarioCounter++,s.failureMetaData.batchEventData.push(o)):s.failureMetaData={batchScenarioCounter:1,batchEventData:[o]},s.failureMetaData.batchScenarioCounter>=1e3?(c(e,r,s.failureMetaData,"failure",n),s.successMetaData&&c(e,r,s.successMetaData,"success",n),l(t,a,r)):u(t,a,r,s)}function c(e,t,r,a,s){const c=n+t,l=e.newScenario(c),u=(0,i.pW)();o.q.log(`[sendBatchScenario] for ${c}, status: ${a}, correlationId:${u}`);const d={accountId:s,context:"auth-telemetry-helper",secondaryCorrelationId:u,batchScenarioData:r};"failure"===a?l.fail(d):l.stop(d)}function l(e,t,r){try{const i=n+r;o.q.log(`[clearBatchScenarioFromCache] scenario: ${i}`);const a=e.getValue(t);null==a||delete a[i],e.put(t,a)}catch(e){o.q.log(`[clearBatchScenarioFromCache] ${null==e?void 0:e.message}`)}}function u(e,t,r,i){try{const o=n+r;let a=e.getValue(t);return a?a[o]=i:a={[o]:i},e.put(t,a),!0}catch(e){return o.q.log(`[setBatchScenarioToAuthCache] ${null==e?void 0:e.message}`),!1}}function d(e,t,r){const o=e.getValue(t);return null==o?void 0:o[n+r]}function h(e,t){let r;if(t){const o=e.getAllOfType("User");r=null==o?void 0:o.filter((e=>e.id===t))[0]}else r=e.getValue({typeName:"User"});if(!r)return void o.q.log("[getBatchCacheKeyForUser] no user found in cache");return{user:{tenantId:r.profile.tid,oid:r.profile.oid,accountType:r.type,userName:r.userName,id:r.id},typeName:"BatchScenario"}}},240277:(e,t,r)=>{r.d(t,{u4:()=>i,VK:()=>n,pW:()=>c});const o=globalThis;function i(e,t){const r=new WeakSet;return JSON.stringify(e,((e,t)=>{if(!r.has(t)){if(t&&"object"==typeof t){if(r.add(t),t instanceof Map||t instanceof Set)return Array.from(t);if(null==t?void 0:t.errorCode)return t;if(t instanceof Error)return`${t.name}: ${t.message}`;if(t.constructor&&t.constructor!==Object&&t.constructor!==Array||t.prototype)return}return t}}),t)}function n(e,t=!0){if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,s(a(t)))}catch(e){return"Stringifying error failed"}}const a=(e=!0)=>(t,r)=>{if(r instanceof Error){const t={};return Object.getOwnPropertyNames(r).forEach((o=>{"stack"===o?e||(t[o]=("string"==typeof r.stack?r.stack:"").split("\n").map((e=>e.trim())).filter((e=>!!e))):t[o]=r[o]})),t}return r},s=e=>{const t=new WeakSet;return(r,o)=>{if("object"==typeof o&&null!==o){if(t.has(o))return;t.add(o)}return e(r,o)}},c=()=>{try{const e=o.msCrypto||o.crypto;return`${[1e7]}-1000-4000-8000-100000000000`.replace(/[018]/g,(t=>(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}catch(e){const t="xxxxxxxx-xxxx-8xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef";let o=0,i="";for(let e=0;e<36;e++)"-"!==t[e]&&"4"!==t[e]&&(o=16*Math.random()|0),"x"===t[e]?i+=r[o]:"y"===t[e]?(o&=3,o|=8,i+=r[o]):i+=t[e];return i}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/41768-52fcf0e41d522120.js.map